<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DODATNI RAD MAXI 123</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 30px auto; max-width: 1000px; background: #f5f7fa; color: #333; }
  h2 { text-align: center; margin-bottom: 25px; color: #2c3e50; }
  table { width: 100%; border-collapse: separate; border-spacing: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); background: white; border-radius: 8px; overflow: hidden; }
  thead td[colspan] { background-color: #34495e; color: #ecf0f1; font-size: 1.3em; font-weight: 700; padding: 15px 0; text-align: center; user-select: none; }
  thead tr:nth-child(2) th { background-color: #2c3e50; color: #ecf0f1; padding: 12px 10px; font-weight: 600; text-transform: uppercase; font-size: 0.9em; letter-spacing: 1px; }
  tbody tr:hover { background-color: #f0f8ff; }
  tbody tr:last-child { background-color: #ecf0f1; font-weight: 700; }
  tbody tr:nth-last-child(2) { background-color: #f9f9f9; font-style: italic; }
  td, th { text-align: center; padding: 12px 10px; border-bottom: 1px solid #ddd; }
  td[data-label="Broj sati"] input[type="number"] {
    text-align: center;
  }
  input[type="text"], input[type="number"] { width: 90%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 0.95em; transition: border-color 0.3s ease; box-sizing: border-box; }
  input[type="text"]:focus, input[type="number"]:focus { border-color: #3498db; outline: none; background-color: #eaf6fd; }
  input[readonly] { background-color: #e1e8f0; border: none; text-align: center; font-weight: 600; color: #555; cursor: default; }
  button { padding: 7px 15px; margin: 2px; border: none; border-radius: 5px; font-weight: 600; font-size: 0.9em; cursor: pointer; transition: background-color 0.3s ease, color 0.3s ease; box-shadow: 0 2px 6px rgba(0,0,0,0.15); user-select: none; }
  button#addRowBtn { background-color: #27ae60; color: white; }
  button#addRowBtn:hover { background-color: #219150; }
  button#clearStorageBtn { background-color: #e67e22; color: white; }
  button#clearStorageBtn:hover { background-color: #ca650d; }
  .updateBtn { background-color: #2980b9; color: white; }
  .updateBtn:hover { background-color: #1f6391; }
  .deleteBtn { background-color: #c0392b; color: white; }
  .deleteBtn:hover { background-color: #992d22; }
  .action-buttons { display: flex; justify-content: center; gap: 6px; }
  .buttons-container { display: flex; justify-content: space-between; margin-top: 20px; }
  #monthButtons { text-align: center; margin-bottom: 20px; }
  #monthButtons button { margin: 0 10px; padding: 8px 20px; font-weight: 700; font-size: 1em; border-radius: 6px; }
  #monthButtons button.active { background-color: #2980b9; color: white; }
  @media (max-width: 800px) {
    body { margin: 15px; }
    table, thead, tbody, th, td, tr { display: block; }
    thead tr { display: none; }
    tbody tr { margin-bottom: 20px; background: white; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border-radius: 8px; padding: 15px; }
    tbody td { border: none; padding: 8px 10px; text-align: right; position: relative; padding-left: 50%; }
    tbody td::before { position: absolute; left: 15px; top: 8px; width: 45%; white-space: nowrap; font-weight: 700; text-align: left; content: attr(data-label); color: #555; }
    .action-buttons { justify-content: flex-start; }
    .buttons-container { flex-direction: column; gap: 10px; }
    button#addRowBtn, button#clearStorageBtn { width: 100%; }
  }
</style>
</head>
<body>

<h2>ŠPANOVIĆ MARKO DODATNI RAD MAXI 123</h2>

<div id="monthButtons" role="group" aria-label="Izbor meseca">
  <button id="btnSeptembar" aria-pressed="false">Septembar 2025</button>
  <button id="btnOktobar" aria-pressed="false">Oktobar 2025</button>
  <button id="btnNovembar" class="active" aria-pressed="true">Novembar 2025</button>
</div>

<table id="dynamicTable" aria-label="Tabela radnih sati">
  <thead>
    <tr><td colspan="6" id="monthHeader">Novembar 2025</td></tr>
    <tr>
      <th>Datum</th>
      <th>Dan</th>
      <th>Početak smene</th>
      <th>Kraj smene</th>
      <th>Broj sati</th>
      <th></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="buttons-container">
  <button id="clearStorageBtn" aria-label="Obriši sve podatke">Obriši sve podatke</button>
  <button id="addRowBtn" aria-label="Dodaj novi red">Dodaj novi red</button>
</div>

<script>
const STORAGE_KEY = "radni_sati_maxi123";

const monthsData = {
  septembar: {
    name: 'Septembar 2025',
    prethodniMesecSati: 0,
    rows: [
      { datum:'2025-09-04', dan:'ČETVRTAK', pocetak:'15:30', kraj:'21:00', brojSati:5.5 },
      { datum:'2025-09-07', dan:'NEDELJA', pocetak:'13:00', kraj:'21:00', brojSati:8 },
      { datum:'2025-09-12', dan:'PETAK', pocetak:'15:30', kraj:'21:00', brojSati:5.5 },
      { datum:'2025-09-14', dan:'NEDELJA', pocetak:'13:00', kraj:'21:00', brojSati:8 },
      { datum:'2025-09-20', dan:'SUBOTA', pocetak:'13:00', kraj:'21:00', brojSati:8 },
      { datum:'2025-09-21', dan:'NEDELJA', pocetak:'15:30', kraj:'21:00', brojSati:5.5 },
      { datum:'2025-09-22', dan:'PONEDELJAK', pocetak:'15:30', kraj:'21:00', brojSati:5.5 },
      { datum:'2025-09-28', dan:'NEDELJA', pocetak:'13:00', kraj:'21:00', brojSati:8 }
    ]
  },
  oktobar: {
    name: 'Oktobar 2025',
    prethodniMesecSati: 27,
    rows: [
      { datum:'2025-10-04', dan:'SUBOTA', pocetak:'13:00', kraj:'21:00', brojSati:8 },
      { datum:'2025-10-05', dan:'NEDELJA', pocetak:'13:00', kraj:'21:00', brojSati:8 },
      { datum:'2025-10-07', dan:'UTORAK', pocetak:'13:00', kraj:'21:00', brojSati:8 },
      { datum:'2025-10-26', dan:'NEDELJA', pocetak:'13:00', kraj:'21:00', brojSati:8 }
    ]
  },
  novembar: {
    name: 'Novembar 2025',
    prethodniMesecSati: 0,
    rows: [
      { datum:'2025-11-05', dan:'SREDA', pocetak:'13:00', kraj:'21:00', brojSati:8 },
      { datum:'2025-11-09', dan:'NEDELJA', pocetak:'13:00', kraj:'21:00', brojSati:8 },
      { datum:'2025-11-13', dan:'ČETVRTAK', pocetak:'07:00', kraj:'12:30', brojSati:5.5 },
      { datum:'2025-11-16', dan:'NEDELJA', pocetak:'13:00', kraj:'21:00', brojSati:8 }
    ]
  }
};

let currentMonth = 'novembar';

let rowsData = [];
let prethodniMesecSati = 0;

const tableBody = document.querySelector('#dynamicTable tbody');
const addRowBtn = document.getElementById('addRowBtn');
const clearBtn = document.getElementById('clearStorageBtn');
const monthHeader = document.getElementById('monthHeader');
const btnSeptembar = document.getElementById('btnSeptembar');
const btnOktobar = document.getElementById('btnOktobar');
const btnNovembar = document.getElementById('btnNovembar');

function saveToStorage() {
  const allData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
  allData[currentMonth] = { rowsData, prethodniMesecSati };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
}

function loadFromStorage() {
  const allData = JSON.parse(localStorage.getItem(STORAGE_KEY));
  if(allData && allData[currentMonth]) {
    rowsData = allData[currentMonth].rowsData;
    prethodniMesecSati = allData[currentMonth].prethodniMesecSati;
  } else {
    rowsData = monthsData[currentMonth].rows.map(r => ({...r}));
    prethodniMesecSati = monthsData[currentMonth].prethodniMesecSati;
  }

  // Dinamički dodavanje redova za oktobar kao i ranije
  if(currentMonth === 'oktobar') {
    const postoji12 = rowsData.some(r => r.datum === '2025-10-12');
    if(!postoji12) {
      rowsData.splice(
        rowsData.findIndex(r => r.datum === '2025-10-07') + 1,
        0,
        { datum:'2025-10-12', dan:'NEDELJA', pocetak:'13:00', kraj:'21:00', brojSati:8 }
      );
    }
    const postoji25 = rowsData.some(r => r.datum === '2025-10-25');
    if(!postoji25) {
      rowsData.push({ datum:'2025-10-25', dan:'SUBOTA', pocetak:'07:00', kraj:'15:00', brojSati:8 });
    }
    // Sortiraj redove po datumu za oktobar
    rowsData.sort((a, b) => {
      if(!a.datum) return 1;
      if(!b.datum) return -1;
      return a.datum.localeCompare(b.datum);
    });
  }
}

function pad2(s){return String(s).padStart(2,'0');}
function formatDateToDDMMYYYY(dateStr){ if(!dateStr) return ''; const parts=dateStr.split('-'); if(parts.length!==3)return dateStr; return `${pad2(parts[2])}/${pad2(parts[1])}/${parts[0]}`; }
function parseDateFromDDMMYYYY(dateStr){ 
  if(!dateStr)return ''; 
  const parts=dateStr.split('/'); if(parts.length!==3)return ''; 
  const d=pad2(parts[0]), m=pad2(parts[1]), y=parts[2]; 
  const iso=`${y}-${m}-${d}`; const dt=new Date(iso); 
  if(isNaN(dt.getTime()))return ''; 
  return `${dt.getFullYear()}-${pad2(dt.getMonth()+1)}-${pad2(dt.getDate())}`;
}
function getDayOfWeek(isoDate){
  const days=['NEDELJA','PONEDELJAK','UTORAK','SREDA','ČETVRTAK','PETAK','SUBOTA'];
  const dt=new Date(isoDate); return isNaN(dt.getTime())?'':days[dt.getDay()];
}
function autoFormatDate(input){
  let v=input.value.replace(/\D/g,'');
  if(v.length>=3)v=v.slice(0,2)+'/'+v.slice(2);
  if(v.length>=6)v=v.slice(0,5)+'/'+v.slice(5,9);
  input.value=v;
}

function isValidTime(timeStr) {
  return /^([01]\d|2[0-3]):([0-5]\d)$/.test(timeStr);
}

function calculateHours(start, end) {
  const [sh, sm] = start.split(':').map(Number);
  const [eh, em] = end.split(':').map(Number);
  let diff = (eh + em/60) - (sh + sm/60);
  if (diff < 0) diff = 0;
  return diff;
}

function handleInputChange(event){
  const index=Number(event.target.dataset.index);
  const field=event.target.dataset.field;
  let value=event.target.value;

  if(field === 'brojSati') {
    const num = parseFloat(value);
    rowsData[index][field] = isNaN(num) ? 0 : num;
    saveToStorage();
    renderTable();
  } else if(field === 'pocetak' || field === 'kraj') {
    rowsData[index][field] = value;
    const p = rowsData[index].pocetak;
    const k = rowsData[index].kraj;
    if(isValidTime(p) && isValidTime(k)) {
      rowsData[index].brojSati = calculateHours(p,k);
    } else {
      rowsData[index].brojSati = 0;
    }
    saveToStorage();
    renderTable();
  }
}

function handleTimeBlur(event) {
  const index = Number(event.target.dataset.index);
  const field = event.target.dataset.field;
  const value = event.target.value;

  if(isValidTime(value)) {
    rowsData[index][field] = value;
  } else {
    rowsData[index][field] = '';
    event.target.value = '';
    alert('Unesite vreme u formatu HH:mm (24h)');
  }
  const p = rowsData[index].pocetak;
  const k = rowsData[index].kraj;
  if(isValidTime(p) && isValidTime(k)) {
    rowsData[index].brojSati = calculateHours(p,k);
  } else {
    rowsData[index].brojSati = 0;
  }
  saveToStorage();
  renderTable();
}

function renderTable(){
  tableBody.innerHTML='';

  rowsData.forEach((row,index)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td data-label="Datum"><input type="text" value="${formatDateToDDMMYYYY(row.datum)}" data-index="${index}" data-field="datum" placeholder="dd/mm/yyyy" /></td>
      <td data-label="Dan"><input type="text" value="${row.dan??''}" readonly /></td>
      <td data-label="Početak smene"><input type="text" value="${row.pocetak??''}" data-index="${index}" data-field="pocetak" placeholder="HH:mm" /></td>
      <td data-label="Kraj smene"><input type="text" value="${row.kraj??''}" data-index="${index}" data-field="kraj" placeholder="HH:mm" /></td>
      <td data-label="Broj sati"><input type="number" step="0.5" min="0" value="${row.brojSati??0}" data-index="${index}" data-field="brojSati" /></td>
      <td data-label="Akcije" class="action-buttons">
        <button class="updateBtn" data-index="${index}">Izmeni</button>
        <button class="deleteBtn" data-index="${index}">Izbriši</button>
      </td>
    `;
    tableBody.appendChild(tr);

    const datumInput=tr.querySelector('td[data-label="Datum"] input');
    datumInput.addEventListener('input',()=>autoFormatDate(datumInput));
    datumInput.addEventListener('blur',()=>{
      const iso=parseDateFromDDMMYYYY(datumInput.value);
      if(!iso){rowsData[index].datum=''; rowsData[index].dan=''; datumInput.value='';}
      else{rowsData[index].datum=iso; rowsData[index].dan=getDayOfWeek(iso); datumInput.value=formatDateToDDMMYYYY(iso);}
      saveToStorage();
      renderTable();
    });

    const pocetakInput = tr.querySelector('input[data-field="pocetak"]');
    const krajInput = tr.querySelector('input[data-field="kraj"]');
    pocetakInput.addEventListener('input', handleInputChange);
    krajInput.addEventListener('input', handleInputChange);
    pocetakInput.addEventListener('blur', handleTimeBlur);
    krajInput.addEventListener('blur', handleTimeBlur);
  });

  const prethodniRow=document.createElement('tr');
  prethodniRow.innerHTML=`
    <td></td><td></td><td colspan="2" style="font-weight:bold; text-align:center;">Nije uplaćeno iz prethodnog meseca</td>
    <td><input type="number" value="${prethodniMesecSati}" readonly step="0.5" /></td>
    <td></td>
  `;
  tableBody.appendChild(prethodniRow);

  if(currentMonth === 'oktobar') {
    const uplacenoRow=document.createElement('tr');
    uplacenoRow.innerHTML=`
      <td colspan="4" style="text-align:center; font-style: italic; font-weight: 600; background-color: #f9f9f9;">
        Uplaćeno u prethodnom mesecu
      </td>
      <td style="font-style: italic; font-weight: 600; background-color: #f9f9f9; text-align: center;">
        27
      </td>
      <td></td>
    `;
    tableBody.appendChild(uplacenoRow);
  }

  const sumaSati=rowsData.reduce((sum,row)=>sum+(parseFloat(row.brojSati)||0),0);
  const total=sumaSati+prethodniMesecSati;
  const totalRow=document.createElement('tr');
  totalRow.innerHTML=`
    <td colspan="3" style="font-weight:bold; text-align:right;">Ukupno sati (sa prethodnim mesecom):</td>
    <td></td>
    <td style="font-weight:bold; text-align:center;">${total}</td>
    <td></td>
  `;
  tableBody.appendChild(totalRow);

  document.querySelectorAll('.updateBtn').forEach(btn=>btn.addEventListener('click',updateRow));
  document.querySelectorAll('.deleteBtn').forEach(btn=>btn.addEventListener('click',deleteRow));
  document.querySelectorAll('input[data-field="brojSati"]').forEach(input=>input.addEventListener('input',handleInputChange));
}

function updateRow(event){
  const index=Number(event.target.dataset.index);
  const r=rowsData[index];
  alert(`Red ${index+1} je prepravljen:\nDatum: ${formatDateToDDMMYYYY(r.datum)}\nDan: ${r.dan}\nPočetak: ${r.pocetak}\nKraj: ${r.kraj}\nBroj sati: ${r.brojSati}`);
  saveToStorage();
}

function deleteRow(event){
  const index=Number(event.target.dataset.index);
  if(confirm(`Da li ste sigurni da želite da izbrišete red ${index+1}?`)){
    rowsData.splice(index,1);
    saveToStorage();
    renderTable();
  }
}

addRowBtn.addEventListener('click',()=>{
  rowsData.push({datum:'',dan:'',pocetak:'',kraj:'',brojSati:0});
  saveToStorage();
  renderTable();
});

clearBtn.addEventListener('click',()=>{
  if(confirm("Da li ste sigurni da želite da obrišete sve podatke?")) {
    const allData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    delete allData[currentMonth];
    localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
    rowsData = [];
    renderTable();
  }
});

btnSeptembar.addEventListener('click',()=>{
  if(currentMonth !== 'septembar'){
    currentMonth = 'septembar';
    monthHeader.textContent = monthsData.septembar.name;
    btnSeptembar.classList.add('active');
    btnSeptembar.setAttribute('aria-pressed', 'true');
    btnOktobar.classList.remove('active');
    btnOktobar.setAttribute('aria-pressed', 'false');
    btnNovembar.classList.remove('active');
    btnNovembar.setAttribute('aria-pressed', 'false');
    loadFromStorage();
    renderTable();
  }
});

btnOktobar.addEventListener('click',()=>{
  if(currentMonth !== 'oktobar'){
    currentMonth = 'oktobar';
    monthHeader.textContent = monthsData.oktobar.name;
    btnOktobar.classList.add('active');
    btnOktobar.setAttribute('aria-pressed', 'true');
    btnSeptembar.classList.remove('active');
    btnSeptembar.setAttribute('aria-pressed', 'false');
    btnNovembar.classList.remove('active');
    btnNovembar.setAttribute('aria-pressed', 'false');
    loadFromStorage();
    renderTable();
  }
});

btnNovembar.addEventListener('click',()=>{
  if(currentMonth !== 'novembar'){
    currentMonth = 'novembar';
    monthHeader.textContent = monthsData.novembar.name;
    btnNovembar.classList.add('active');
    btnNovembar.setAttribute('aria-pressed', 'true');
    btnSeptembar.classList.remove('active');
    btnSeptembar.setAttribute('aria-pressed', 'false');
    btnOktobar.classList.remove('active');
    btnOktobar.setAttribute('aria-pressed', 'false');
    loadFromStorage();
    renderTable();
  }
});

loadFromStorage();
renderTable();
</script>

</body>
</html>
